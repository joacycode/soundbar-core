!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).soundbarCore=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e){return Object.prototype.toString.call(e)}var o=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===c(e)},u=function(e){return"[object Object]"===c(e)},s={REG_AND:/^\$&$/g,REG_OR:/^\$\|$/g,REG_NOT:/^\$\^$/g,REG_RULEPATH:/^\$(\.\w+)+/g,REG_LT:/^\$</g,REG_LTE:/^\$<=/g,REG_GT:/^\$>/g,REG_GTE:/^\$>=/g,REG_NOTEQUAL:/^\$!=/g,REG_BETWEEN:/^\$<>/g,REG_EXP:/^\$\$/g},l=o,f=function(e){return"[object Undefined]"===c(e)},h=u,p=s,g={sourceMatchConditions:function(e,t){var r=p.REG_NOT,n=p.REG_LT,i=p.REG_LTE,a=p.REG_GT,c=p.REG_GTE,o=p.REG_NOTEQUAL,u=p.REG_BETWEEN,s=p.REG_EXP,f=p.REG_OR,d=p.REG_AND,y=Object.keys(t),m=y.length,b=[],v=g.compareResult,E=!0;if(0===m)return!1;for(var O=0;O<m;O++){var N=y[O],R=t[N];if(N.match(r)){var G=N.replace(r,"");b.push=G}else if(N.match(n)){var j=N.replace(n,""),w=v(e,j,R,"lt");E=E&&w}else if(N.match(i)){var M=N.replace(i,""),_=v(e,M,R,"lte");E=E&&_}else if(N.match(a)){var T=N.replace(a,""),$=v(e,T,R,"gt");E=E&&$}else if(N.match(c)){var P=N.replace(c,""),D=v(e,P,R,"gte");E=E&&D}else if(N.match(o)){var k=N.replace(o,""),L=v(e,k,R,"notEqual");E=E&&L}else if(N.match(u)){var A=N.replace(u,""),C=v(e,A,R,"bt");E=E&&C}else if(N.match(s)){var B=N.replace(s,""),F=v(e,B,R,"reg");E=E&&F}else N.match(f)||function(){var t=void 0;if(t=N.match(d)?N.replace(d,""):N,l(R)){var r=!1;R.map((function(n){r=r||v(e,t,n)})),E=E&&r}else E=E&&v(e,t,R)}()}return b.length>0&&b.map((function(t){h(e)&&e.hasOwnProperty(t)&&delete e[t]})),{sourceData:e,matched:E}},fetchOutKeyChild:function(e,t){var r=[];return r.mutilRes=!0,e.map((function(e,n){f(e[t])||r.push(e[t])})),r},switchMathCompare:function(e,t,r){try{switch(r){case"lt":return!Object.is(+e,NaN)&&!Object.is(+t,NaN)&&+e<+t;case"lte":return!Object.is(+e,NaN)&&!Object.is(+t,NaN)&&+e<=+t;case"gt":return!Object.is(+e,NaN)&&!Object.is(+t,NaN)&&+e>+t;case"gte":return!Object.is(+e,NaN)&&!Object.is(+t,NaN)&&+e>=+t;case"notEqual":return e!==t;case"bt":return!(Object.is(+e,NaN)||Object.is(+t[0],NaN)||Object.is(+t[1],NaN))&&(e>t[0]&&e<t[1]);case"reg":var n=new RegExp(t[0],t[1]);return!!e.match(n);default:return e===t}}catch(e){return!1}},compareResult:function(e,t,r,n){var i=g.switchMathCompare,a=e[t];if(!a)return!1;if(l(a)){if("number"!=typeof r)throw Error("Arrays condition value not a number");return i(a.length,r,n)}return("string"==typeof a||"number"==typeof a)&&i(a,r,n)}},d=g,y=d.fetchOutKeyChild,m=d.sourceMatchConditions,b=o,v=u,E=s,O=function(){function t(r,n){e(this,t),this.mergeGroupsList={},this.clientQueryMergeRule=r,this.sourceBody=n}return r(t,[{key:"addNewMergeData",value:function(e){var t=m(e.sourceMatched,e.conditions),r=t.matched,n=t.sourceData;if(!r)return!1;this.mergeGroupsList[e.mergeGroupName].push(n)}},{key:"mergeHandler",value:function(e,t,r){var n=this;if(b(e))if(e.mutilRes)for(var i=e.length,a=0;a<i;a++)b(e[a])?e[a].map((function(e){n.addNewMergeData({sourceMatched:e,mergeGroupName:t,conditions:r})})):v(e[a])&&this.addNewMergeData({sourceMatched:e[a],mergeGroupName:t,conditions:r});else e.map((function(e){n.addNewMergeData({sourceMatched:e,mergeGroupName:t,conditions:r})}));else v(e)&&this.addNewMergeData({sourceMatched:e,mergeGroupName:t,conditions:r})}},{key:"sourceDataMapRulePath",value:function(e,t){var r=E.REG_RULEPATH,n=a({},t);if(e.match(r))for(var i=e.split(".").splice(1),c=i.length,o=0;o<c;o++){if(v(n))n=n[i[o]];else if(b(n)){if(o+1!==c)throw Error("进入数组后筛选出来是最终层级，不能有更深的层级了，".concat(i[o-1],"是数组，").concat(i[o],"是终点深度"));n=y(n,i[o])}if(!n)return!1}else{var u=n[e];n=u||{}}return n}},{key:"getMergeGroup",get:function(){if(this.sourceBody){if(!this.clientQueryMergeRule)return this.sourceBody;for(var e=Object.keys(this.clientQueryMergeRule),t=e.length,r=0;r<t;r++){var n=void 0,i=e[r],a=this.clientQueryMergeRule[i];this.mergeGroupsList[i]=[];var c=Object.keys(a)[0],o=this.sourceDataMapRulePath(c,this.sourceBody),u=a[c];u["$|"]&&(n=u["$|"],delete u["$|"]),this.mergeHandler(o,i,u),0===this.mergeGroupsList[i].length&&this.mergeHandler(o,i,n)}return this.mergeGroupsList}}}]),t}(),N=o,R=u,G=d.sourceMatchConditions;return{MergeCore:O,FilterCore:function(){function t(r,n){e(this,t),this.clientQueryFilterRule=r,this.sourceBody=n}return r(t,[{key:"objectFilterEvent",value:function(e,t){var r=t["$^"];if(!R(e)||!r)return!1;r.map((function(t){e.hasOwnProperty(t)&&delete e[t]}))}},{key:"arrayFilterEvent",value:function(e,t){return!!N(e)&&e.filter((function(e){return!G(e,t).matched}))}},{key:"getFilterGroup",get:function(){var e=this,t=this.clientQueryFilterRule,r=this.sourceBody;if(r){if(!t)return r;var n=a({},r),i=Object.keys(t);i.sort((function(e,t){return e.length-t.length}));for(var c=i.length,o=function(r){for(var a=n,c=i[r],o=t[c],u=c.split(".").splice(1),s=u.length,l=0;l<s;l++)if(a=a[u[l]],N(a)&&l===s-1){var f=e.arrayFilterEvent(a,o);f&&(a.length=0,f.map((function(e){a.push(e)})))}else e.objectFilterEvent(a,o)},u=0;u<c;u++)o(u);return n}}}]),t}()}}));
